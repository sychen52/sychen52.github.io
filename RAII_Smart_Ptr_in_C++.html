<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RAII and Smart Pointer in C++</title>
<meta name="generator" content="Org mode" />
<link rel="stylesheet" type="text/css" href="https://orgmode.org/worg/style/worg.css"/>
</head>
<body>
<div id="content">
<h1 class="title">RAII and Smart Pointer in C++</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org922bef8">Pass pointers in C++</a>
<ul>
<li><a href="#orgf6e9a07">Raw pointer or reference</a></li>
<li><a href="#org8d83322"><code>unique_ptr</code></a></li>
<li><a href="#org3a160e7"><code>shared_ptr</code></a></li>
<li><a href="#orgc16c9f3"><code>unique_ptr&amp;</code> or <code>shared_ptr&amp;</code></a></li>
<li><a href="#orge9413d3"><code>const unique_ptr</code> or <code>const shared_ptr</code></a></li>
<li><a href="#org0b4cb11"><code>const unique_ptr&amp;</code> or <code>const shared_ptr&amp;</code></a></li>
</ul>
</li>
<li><a href="#org689d59c">RAII: Resource Acquisition is Initialization: it means to cleanup in the destructor.</a>
<ul>
<li><a href="#orgb9770a8">This applies to raw heap pointers, file handles, mutex, etc.</a></li>
<li><a href="#orgc9fb46b">The Rule of Three: all three need to be user defined if RAII.</a></li>
<li><a href="#org0a6548d">Destroctor is called even after throw</a></li>
<li><a href="#org4afd5a2">The Rule of Three: if not RAII (don't store data or contains only well written Rule of Three classes)</a></li>
<li><a href="#orgc3c6a00">The Rule of Five:</a></li>
<li><a href="#org85dd020">The Rule of Four and a half:</a></li>
<li><a href="#org6611a94">Good examples</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org922bef8" class="outline-2">
<h2 id="org922bef8"><a href="https://levelup.gitconnected.com/passing-smart-pointers-in-c-479775632443">Pass pointers in C++</a></h2>
<div class="outline-text-2" id="text-org922bef8">
</div>
<div id="outline-container-orgf6e9a07" class="outline-3">
<h3 id="orgf6e9a07">Raw pointer or reference</h3>
<div class="outline-text-3" id="text-orgf6e9a07">
<ul class="org-ul">
<li>it is considered as borrow</li>
<li>lifetime needs to be guaranteed. (unlike Rust, C++ compiler does not guarantee this for you.)</li>
<li>raw pointer can be nullptr while reference cannot.</li>
</ul>
</div>
</div>
<div id="outline-container-org8d83322" class="outline-3">
<h3 id="org8d83322"><code>unique_ptr</code></h3>
<div class="outline-text-3" id="text-org8d83322">
<ul class="org-ul">
<li>transfer ownership (move)</li>
<li>This is the default in Rust.</li>
</ul>
</div>
</div>
<div id="outline-container-org3a160e7" class="outline-3">
<h3 id="org3a160e7"><code>shared_ptr</code></h3>
<div class="outline-text-3" id="text-org3a160e7">
<ul class="org-ul">
<li>Shared ownership.</li>
</ul>
</div>
</div>
<div id="outline-container-orgc16c9f3" class="outline-3">
<h3 id="orgc16c9f3"><code>unique_ptr&amp;</code> or <code>shared_ptr&amp;</code></h3>
<div class="outline-text-3" id="text-orgc16c9f3">
<ul class="org-ul">
<li>Consider using raw pointer, since the idea is the same.</li>
<li>Unless you want to do something to the smart ptr itself.</li>
</ul>
</div>
</div>
<div id="outline-container-orge9413d3" class="outline-3">
<h3 id="orge9413d3"><code>const unique_ptr</code> or <code>const shared_ptr</code></h3>
<div class="outline-text-3" id="text-orge9413d3">
<ul class="org-ul">
<li>This means the smart ptr object is const, can you cannot modify (e.g. reset) the smart ptr. This is not the smart version of const Raw*.</li>
</ul>
</div>
</div>
<div id="outline-container-org0b4cb11" class="outline-3">
<h3 id="org0b4cb11"><code>const unique_ptr&amp;</code> or <code>const shared_ptr&amp;</code></h3>
<div class="outline-text-3" id="text-org0b4cb11">
<ul class="org-ul">
<li>You should use raw pointer. In this case, you cannot even modify the smart<sub>ptr</sub></li>
</ul>
</div>
</div>
</div>


<div id="outline-container-org689d59c" class="outline-2">
<h2 id="org689d59c"><a href="https://www.youtube.com/watch?v=7Qgd9B1KuMQ">RAII: Resource Acquisition is Initialization: it means to cleanup in the destructor.</a></h2>
<div class="outline-text-2" id="text-org689d59c">
</div>
<div id="outline-container-orgb9770a8" class="outline-3">
<h3 id="orgb9770a8">This applies to raw heap pointers, file handles, mutex, etc.</h3>
</div>
<div id="outline-container-orgc9fb46b" class="outline-3">
<h3 id="orgc9fb46b">The Rule of Three: all three need to be user defined if RAII.</h3>
<div class="outline-text-3" id="text-orgc9fb46b">
<ul class="org-ul">
<li>destructor</li>
<li>copy ctor
<ul class="org-ul">
<li>The default will lead to double deletion</li>
</ul></li>
<li>copy assignment: use copy-and-swap to implement it.
<ul class="org-ul">
<li>copy: call copy ctor and generate a new object</li>
<li>swap: swap LHS and the new object and use the new objects' destructor to free the LHS.</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org0a6548d" class="outline-3">
<h3 id="org0a6548d">Destroctor is called even after throw</h3>
</div>
<div id="outline-container-org4afd5a2" class="outline-3">
<h3 id="org4afd5a2">The Rule of Three: if not RAII (don't store data or contains only well written Rule of Three classes)</h3>
<div class="outline-text-3" id="text-org4afd5a2">
<p>
Let compiler generate them.
</p>
</div>
</div>
<div id="outline-container-orgc3c6a00" class="outline-3">
<h3 id="orgc3c6a00">The Rule of Five:</h3>
<div class="outline-text-3" id="text-orgc3c6a00">
<ul class="org-ul">
<li>all three rules plus</li>
<li>move ctor
<ul class="org-ul">
<li>Destroy RHS</li>
</ul></li>
<li>move assignment
<ul class="org-ul">
<li>move: call move ctor: RHS is destroyed.</li>
<li>swap: same as before, use the destructor of the new object to free LHS.</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org85dd020" class="outline-3">
<h3 id="org85dd020">The Rule of Four and a half:</h3>
<div class="outline-text-3" id="text-org85dd020">
<ul class="org-ul">
<li>All three ctors</li>
<li>merge copy and move assignment into a value assignment
<ul class="org-ul">
<li>since the first thing of these two are creating a copy (through copy or move ctor) anyway</li>
</ul></li>
<li>The half is the swap function.
<ul class="org-ul">
<li>Otherwise, the default swap will call move and copy.</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org6611a94" class="outline-3">
<h3 id="org6611a94">Good examples</h3>
<div class="outline-text-3" id="text-org6611a94">
<ul class="org-ul">
<li><code>unique_ptr</code>: ctor, move ctor and move assignment</li>
<li><code>shared_ptr</code>: all five</li>
<li><code>unique_lock</code></li>
<li><code>ifstream</code></li>
<li><code>lock_guard</code>: just ctor and destructor</li>
</ul>


<script src="https://utteranc.es/client.js"
        repo="sychen52/sychen52.github.io"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="validation"></p>
</div>
</body>
</html>
